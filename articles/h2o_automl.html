<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lares">
<title>Introduction to AutoML using lares • lares</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to AutoML using lares">
<meta property="og:description" content="lares">
<meta property="og:image" content="https://laresbernardo.github.io/lares/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-166493168-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166493168-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lares</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">5.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/h2o_automl.html">Introduction to AutoML using lares</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/laresbernardo/lares/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to AutoML using lares</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/laresbernardo/lares/blob/HEAD/vignettes/h2o_automl.Rmd" class="external-link"><code>vignettes/h2o_automl.Rmd</code></a></small>
      <div class="d-none name"><code>h2o_automl.Rmd</code></div>
    </div>

    
    
<p>The <code>lares</code> package has multiple families of functions to
help the analyst or data scientist achieve quality robust analysis
without the need of much coding. One of the most complex but valuable
functions we have is <code>h2o_automl</code>, which semi-automatically
runs the whole pipeline of a Machine Learning model given a dataset and
some customizable parameters. <strong>AutoML</strong> enables you to
train high-quality models specific to your needs and accelerate the
research and development process.</p>
<p><strong>HELP</strong>: Before getting to the code, I recommend
checking <code>h2o_automl</code>’s full documentation <a href="https://laresbernardo.github.io/lares/reference/h2o_automl.html">here</a>
or within your R session by running <code><a href="../reference/h2o_automl.html">?lares::h2o_automl</a></code>. In
it you’ll find a brief description of all the parameters you can set
into the function to get exactly what you need and control how it
behaves.</p>
<div class="section level2">
<h2 id="pipeline">Pipeline<a class="anchor" aria-label="anchor" href="#pipeline"></a>
</h2>
<p>In short, these are some of the things that happen on its
backend:</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/laresbernardo/lares/master/man/figures/automl_map.png" style="width:100.0%" alt=""><p class="caption">Mapping <code>h2o_automl</code></p>
</div>
<ol style="list-style-type: decimal">
<li><p>Input a dataframe <code>df</code> and choose which one is the
independent variable (<code>y</code>) you’d like to predict. You may
set/change the <code>seed</code> argument to guarantee reproducibility
of your results.</p></li>
<li><p>The function decides if it’s a classification (categorical) or
regression (continuous) model looking at the independent variable’s
(<code>y</code>) class and number of unique values, which can be control
with the <code>thresh</code> parameter.</p></li>
<li><p>The dataframe will be split in two: test and train datasets. The
proportion of this split can be control with the <code>split</code>
argument. This can be replicated with the <code><a href="../reference/msplit.html">msplit()</a></code>
function.</p></li>
<li><p>You could also <code>center</code> and <code>scale</code> your
numerical values before you continue, use the <code>no_outliers</code>
to exclude some outliers, and/or <code>impute</code> missing values with
<code>MICE</code>. If it’s a classification model, the function can
balance (under-sample) your training data. You can control this behavior
with the <code>balance</code> argument. Until here, you can replicate
the whole process with the <code><a href="../reference/model_preprocess.html">model_preprocess()</a></code>
function.</p></li>
<li><p>Runs <code>h2o::h2o.automl(...)</code> to train multiple models
and generate a leaderboard with the top (<code>max_models</code> or
<code>max_time</code>) models trained, sorted by their performance. You
can also customize some additional arguments such as <code>nfolds</code>
for k-fold cross-validations, <code>exclude_algos</code> and
<code>include_algos</code> to exclude or include some algorithms, and
any other additional argument you wish to pass to the mother
function.</p></li>
<li><p>The best model given the default performance metric (which can be
changed with <code>stopping_metric</code> parameter) evaluated with
cross-validation (customize it with <code>nfolds</code>), will be
selected to continue. You can also use the function
<code><a href="../reference/h2o_selectmodel.html">h2o_selectmodel()</a></code> to select another model and
recalculate/plot everything again using this alternate model.</p></li>
<li><p>Performance metrics and plots will be calculated and rendered
given the test predictions and test actual values (which were NOT passed
to the models as inputs to be trained with). That way, your model’s
performance metrics shouldn’t be biased. You can replicate these
calculations with the <code><a href="../reference/model_metrics.html">model_metrics()</a></code> function.</p></li>
<li><p>A list with all the inputs, leaderboard results, best selected
model, performance metrics, and plots. You can either (play) see the
results on console or export them using the
<code><a href="../reference/export_results.html">export_results()</a></code> function.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="load-the-library">Load the library<a class="anchor" aria-label="anchor" href="#load-the-library"></a>
</h2>
<p>Now, let’s (install and) load the library, the data, and dig in:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("lares")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/laresbernardo/lares" class="external-link">lares</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The data we'll use is the Titanic dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dft</span>, select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Ticket</span>, <span class="va">PassengerId</span>, <span class="va">Cabin</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>NOTE</strong>: I’ll randomly set some parameters on each
example to give visibility on some of the arguments you can set to your
models. Be sure to also check all the print, warnings, and messages
shown throughout the process as they may have relevant information
regarding your inputs and the backend operations.</p>
</div>
<div class="section level2">
<h2 id="modeling-examples">Modeling examples<a class="anchor" aria-label="anchor" href="#modeling-examples"></a>
</h2>
<p>Let’s have a look at three specific examples: <strong>classification
models (binary and multiple categories) and a regression model</strong>.
Also, let’s see how we can export our models and put them to work on any
environment.</p>
<div class="section level3">
<h3 id="classification-binary">Classification: Binary<a class="anchor" aria-label="anchor" href="#classification-binary"></a>
</h3>
<p>Let’s begin with a binary (TRUE/FALSE) model to predict if each
passenger <code>Survived</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h2o_automl.html">h2o_automl</a></span><span class="op">(</span><span class="va">df</span>, y <span class="op">=</span> <span class="va">Survived</span>, max_models <span class="op">=</span> <span class="fl">1</span>, impute <span class="op">=</span> <span class="cn">FALSE</span>, target <span class="op">=</span> <span class="st">"TRUE"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h2o_automl(df, y = Survived, max_models = 1, impute = FALSE, : could not find function "h2o_automl"</span></span></code></pre></div>
<p>Let’s take a look at the plots generated into a single dashboard:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in plot(r): object 'r' not found</span></span></code></pre></div>
<p>We also have several calculations for our model’s performance that
may come useful such as a confusion matrix, gain and lift by percentile,
area under the curve (AUC), accuracy (ACC), recall or true positive rate
(TPR), cross-validation metrics, exact thresholds to maximize each
metric, and others:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span><span class="op">$</span><span class="va">metrics</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'r' not found</span></span></code></pre></div>
<p>The same goes for the plots generated for these metrics. We have the
gains and response plots on test data-set, confusion matrix, and ROC
curves.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">metrics</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'r' not found</span></span></code></pre></div>
<p>For all models, regardless of their type (classification or
regression), you can check the importance of each variable as well:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">importance</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in head(r$importance): object 'r' not found</span></span>
<span></span>
<span><span class="va">r</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">importance</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'r' not found</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="classification-multi-categorical">Classification: Multi-Categorical<a class="anchor" aria-label="anchor" href="#classification-multi-categorical"></a>
</h3>
<p>Now, let’s run a multi-categorical (+2 labels) model to predict
<code>Pclass</code> of each passenger:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h2o_automl.html">h2o_automl</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">Pclass</span>, ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fare"</span>, <span class="st">"Cabin"</span><span class="op">)</span>, max_time <span class="op">=</span> <span class="fl">30</span>, plots <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h2o_automl(df, Pclass, ignore = c("Fare", "Cabin"), max_time = 30, : could not find function "h2o_automl"</span></span></code></pre></div>
<p>Let’s take a look at the plots generated into a single dashboard:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in plot(r): object 'r' not found</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h3>
<p>Finally, a regression model with continuous values to predict
<code>Fare</code> payed by passenger:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h2o_automl.html">h2o_automl</a></span><span class="op">(</span><span class="va">df</span>, y <span class="op">=</span> <span class="st">"Fare"</span>, ignore <span class="op">=</span> <span class="st">"Pclass"</span>, exclude_algos <span class="op">=</span> <span class="cn">NULL</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h2o_automl(df, y = "Fare", ignore = "Pclass", exclude_algos = NULL, : could not find function "h2o_automl"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in print(r): object 'r' not found</span></span></code></pre></div>
<p>Let’s take a look at the plots generated into a single dashboard:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in plot(r): object 'r' not found</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="export-models-and-results">Export models and results<a class="anchor" aria-label="anchor" href="#export-models-and-results"></a>
</h2>
<p>Once you have you model trained and picked, you can export the model
and it’s results, so you can put it to work in a production environment
(doesn’t have to be R). There is a function that does all that for you:
<code><a href="../reference/export_results.html">export_results()</a></code>. Simply pass your <code>h2o_automl</code>
list object into this function and that’s it! You can select which
formats will be exported using the <code>which</code> argument.
Currently we support: <code>txt</code>, <code>csv</code>,
<code>rds</code>, <code>binary</code>, <code>mojo</code> [best format
for production], and <code>plots</code>. There are also 2 quick options
(<code>dev</code> and <code>production</code>) to export some or all the
files. Lastly, you can set a custom <code>subdir</code> to gather
everything into a new sub-directory; I’d recommend using the model’s
name or any other convention that helps you know which one’s which.</p>
</div>
<div class="section level2">
<h2 id="import-and-use-your-models">Import and use your models<a class="anchor" aria-label="anchor" href="#import-and-use-your-models"></a>
</h2>
<p>If you’d like to re-use your exported models to predict new datasets,
you have several options:</p>
<ul>
<li>
<code><a href="../reference/h2o_predict_MOJO.html">h2o_predict_MOJO()</a></code> <em>[recommended]</em>: This
function lets the user predict using <code>h2o</code>’s
<code>.zip</code> file containing the MOJO files. These files are also
the ones used when putting the model into production on any other
environment. Also, MOJO let’s you change <code>h2o</code>’s versions
without issues</li>
<li>
<code><a href="../reference/h2o_predict_binary.html">h2o_predict_binary()</a></code>: This function lets the user
predict using the h2o binary file. The <code>h2o</code> version/build
must match for it to work.</li>
<li>
<code><a href="../reference/h2o_predict_model.html">h2o_predict_model()</a></code>: This function lets the user run
predictions from a <code>H2O Model Object</code> same as you’d use the
<code>predict</code> base function. Will probably only work in your
current session as you must have the actual trained object to use
it.</li>
</ul>
</div>
<div class="section level2">
<h2 id="addittional-posts">Addittional Posts<a class="anchor" aria-label="anchor" href="#addittional-posts"></a>
</h2>
<ul>
<li>DataScience+: <a href="https://datascienceplus.com/machine-learning-results-one-plot-to-rule-them-all/" class="external-link">Visualizations
for Classification Models Results</a>
</li>
<li>DataScience+: <a href="https://datascienceplus.com/machine-learning-results-in-r-one-plot-to-rule-them-all-part-2-regression-models/" class="external-link">Visualizations
for Regression Models Results</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bernardo Lares.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
